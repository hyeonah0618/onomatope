<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        :root {
            --green: #A2CCB6;
            --yellow: #FCEEB5;
            --peach: #EE786E;
            --off-white: #FFFFF4;
        }

        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'BestTen-CRT';
            src: url('../../fonts/BestTen-CRT.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
      
        body {
            background-color: rgb(67, 67, 67);
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .title {
            color: mintcream;
            text-transform: uppercase;
            font-size: 18px;
            letter-spacing: 0.3em;
            margin: 0;
        }

        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 0.2em;
        }

        .row {
            list-style: none;
            display: flex;
            padding: 0;
            margin: 0;
        }

        li {
  height: 3em;
  width: 3em;
  color: rgba(0,0,0,0.7);
  border-radius: 0.4em;
  line-height: 3em;
  letter-spacing: 1px;
  margin: 0.4em;
  transition: 0.3s;
  text-align: center;
  font-size: 1em;
}

        #tab { width: 4em; background-color: var(--yellow) !important; }
        #caps { width: 5em; background-color: var(--yellow) !important; }
        #left-shift { width: 6.5em; background-color: var(--yellow) !important; }
        #enter { width: 5em; background-color: var(--yellow) !important; }
        #right-shift { width: 6.5em; background-color: var(--yellow) !important; }
        #back { width: 4em; background-color: var(--yellow) !important; }
        #key.one { width: 12em; background-color: var(--yellow) !important; }

        /* 숫자 키 색상 변경 */
        .row-0 li:not(#back) {
            background-color: var(--peach);
            border: 2px solid var(--peach);
        }

        /* 방향키 색상 변경 */
        .pointer1st, .pointer2nd { 
            background-color: var(--green);
            border: 2px solid var(--green);
        }

        /* 나머지 키 색상 변경 */
        .pinky:not(#tab):not(#caps):not(#left-shift):not(#enter):not(#right-shift):not(#back),
        .ring, 
        .middle { 
            background-color: var(--off-white);
            border: 2px solid var(--off-white);
        }

        .selected {
            background-color: rgb(255, 255, 255, 0.2);
            color: white !important;
        }

        .hit {
            animation: hit 0.2s ease-out;
            color: white !important;
        }

        @keyframes hit {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .typewriter-text {
            width: 100%;
            text-align: center;
            font-family: "Courier New", monospace;
            font-size: 28px;
            color: white;
            white-space: pre-wrap;
            min-height: 30px;
            padding: 10px;
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 24px;
            background-color: white;
            margin-left: 4px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* 작은 화면을 위한 미디어 쿼리 */
        @media (max-height: 800px) {
            body {
                gap: 10px;
            }
            
            .keyboard {
                transform: scale(0.75);
            }
            
            .typewriter-text {
                font-size: 24px;
            }
            
            .title {
                font-size: 16px;
            }
        }


        /* 잘못된 입력 스타일 */
        .typewriter-text.error {
            color: #ff4444;
        }

        /* 스페이스바 컨테이너 스타일 */
        .row:last-child {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        /* 스페이스바 스타일 */
        .key.one {
            width: 12em;
            background-color: #ff4444;  /* 빨간색 배경 */
        }

        .key.one.hit {
            background-color: #ff6666;  /* 눌렀을 때의 빨간색 */
        }

    </style>
    <link rel="stylesheet" href="../common.css">
</head>
<body>
    <div class="typewriter-text"></div>
    <div class="keyboard">
        <ul class="row row-0">
            <li class="pinky" id="esc">ESC</li>
            <li class="pinky" id="1">1</li>
            <li class="ring" id="2">2</li>
            <li class="middle" id="3">3</li>
            <li class="pointer1st" id="4">4</li>
            <li class="pointer2nd" id="5">5</li>
            <li class="pointer2nd" id="6">6</li>
            <li class="pointer1st" id="7">7</li>
            <li class="middle" id="8">8</li>
            <li class="ring" id="9">9</li>
            <li class="pinky" id="10">0</li>
            <li class="pinky" >-</li>
            <li class="pinky" >+</li>
            <li class="pinky" id="back">BACK</li>
        </ul>
        <ul class="row row-1">
            <li class="pinky" id="tab">TAB</li>
            <li class="pinky" id="Q">Q</li>
            <li class="ring" id="W">W</li>
            <li class="middle" id="E">E</li>
            <li class="pointer1st" id="R">R</li>
            <li class="pointer2nd" id="T">T</li>
            <li class="pointer2nd" id="Y">Y</li>
            <li class="pointer1st" id="U">U</li>
            <li class="middle" id="I">I</li>
            <li class="ring" id="O">O</li>
            <li class="pinky" id="P">P</li>
            <li class="pinky" >[</li>
            <li class="pinky" >]</li>
            <li class="pinky" >\</li>
        </ul>
        <ul class="row row-2">
            <li class="pinky" id="caps">CAPS</li>
            <li class="pinky" id="A">A</li>
            <li class="ring" id="S">S</li>
            <li class="middle" id="D">D</li>
            <li class="pointer1st" id="F">F</li>
            <li class="pointer2nd" id="G">G</li>
            <li class="pointer2nd" id="H">H</li>
            <li class="pointer1st" id="J">J</li>
            <li class="middle" id="K">K</li>
            <li class="ring" id="L">L</li>
            <li class="pinky" >:</li>
            <li class="pinky" >''</li>
            <li class="pinky" id="enter">ENTER</li>
        </ul>
        <ul class="row row-3">
            <li class="pinky" id="left-shift">SHIFT</li>
            <li class="pinky" id="Z">Z</li>
            <li class="ring" id="X">X</li>
            <li class="middle" id="C">C</li>
            <li class="pointer1st" id="V">V</li>
            <li class="pointer2nd" id="B">B</li>
            <li class="pointer2nd" id="N">N</li>
            <li class="pointer1st" id="M">M</li>
            <li class="middle" >,</li>
            <li class="ring" >.</li>
            <li class="pinky" >;</li>
            <li class="key.one" id="right-shift">SHIFT</li>
        </ul>
        <ul class="row row-4">
            <li class="key.one" id="key.one">SPACE</li>
        </ul>
    </div>
    <h1 class="title">Type the highlighted keys</h1>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const targetText = "HelloWorld";
        let currentIndex = 0;
        let typedText = [];
        const typewriterElement = document.querySelector('.typewriter-text');
        
        const cursor = document.createElement('span');
        cursor.className = 'cursor';

        function updateDisplay() {
            typewriterElement.innerHTML = '';
            typedText.forEach(char => {
                const span = document.createElement('span');
                span.textContent = char.text;
                if (char.isError) {
                    span.style.color = '#ff4444';
                }
                typewriterElement.appendChild(span);
            });
            typewriterElement.appendChild(cursor);
        }

        function highlightNextKey() {
            document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            
            if (currentIndex < targetText.length) {
                const nextChar = targetText[currentIndex].toUpperCase();
                let key;
                
                switch(nextChar) {
                    case ' ':
                        key = document.querySelector('li[id="SPACE"]');
                        break;
                    case '!':
                        key = document.querySelector('li[id="1"]');
                        break;
                    default:
                        key = document.querySelector(`li[id="${nextChar}"]`);
                }
                
                if (key) {
                    key.classList.add("selected");
                }
            }
        }

        // 오디오 객체들 미리 생성
        const audioFiles = {
            kr: new Audio('../audio/1/keyboard_kr.mp3'),
            jp: new Audio('../audio/1/keyboard_jp.mp3'),
            en: new Audio('../audio/1/keyboard_en.mp3')
        };

        // 오디오 파일 미리 로드
        Object.values(audioFiles).forEach(audio => {
            audio.load();
            audio.preload = 'auto';
        });

        const randomTexts = [
            { text: '딸깍', font: 'DungGeunMo', audio: audioFiles.kr },
            { text: 'カチッ', font: 'BestTen-CRT', audio: audioFiles.jp },
            { text: 'click', font: 'DungGeunMo', audio: audioFiles.en }
        ];

        let audioQueue = [];
        let isPlaying = false;

        function playNextAudio() {
            if (audioQueue.length > 0 && !isPlaying) {
                isPlaying = true;
                const audio = audioQueue.shift();
                audio.play().then(() => {
                    audio.onended = () => {
                        isPlaying = false;
                        playNextAudio();
                    };
                }).catch(error => {
                    console.error('Audio playback failed:', error);
                    isPlaying = false;
                    playNextAudio();
                });
            }
        }

        function playRandomSound() {
            // 50% 확률로 소리 재생
            if (Math.random() < 0.5) {
                const randomItem = randomTexts[Math.floor(Math.random() * randomTexts.length)];
                audioQueue.push(randomItem.audio);
                playNextAudio();
            }
        }

        function showRandomText() {
            const randomItem = randomTexts[Math.floor(Math.random() * randomTexts.length)];
            
            // 랜덤 텍스트 표시
            const textEffect = document.createElement('div');
            textEffect.textContent = randomItem.text;
            textEffect.style.position = 'fixed';
            textEffect.style.fontFamily = randomItem.font;
            textEffect.style.color = '#7FFF00';  // 형광연두색으로 변경
            textEffect.style.fontSize = '36px';
            textEffect.style.pointerEvents = 'none';
            textEffect.style.opacity = '0';
            textEffect.style.transform = 'translateY(-20px)';
            textEffect.style.transition = 'all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            
            // 랜덤 위치 설정
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 100);
            textEffect.style.left = x + 'px';
            textEffect.style.top = y + 'px';
            
            document.body.appendChild(textEffect);
            
            // 등장 애니메이션 (약간의 지연 후 실행)
            setTimeout(() => {
                textEffect.style.opacity = '1';
                textEffect.style.transform = 'translateY(0)';
            }, 50);
            
            // 2초 동안 유지 후 페이드 아웃 및 아래로 이동
            setTimeout(() => {
                textEffect.style.opacity = '0';
                textEffect.style.transform = 'translateY(20px)';
            }, 2000);
            
            // 페이드 아웃 애니메이션이 끝난 후 요소 제거
            setTimeout(() => {
                document.body.removeChild(textEffect);
            }, 2300);
        }

        document.addEventListener('keydown', function(event) {
            const expectedChar = currentIndex < targetText.length ? targetText[currentIndex] : '';
            const pressedKey = event.key === ' ' ? ' ' : event.key;

            if (event.key === 'Backspace') {
                if (typedText.length > 0) {
                    // 마지막 문자가 올바른 입력이었다면 이전 상태로 돌아가기
                    if (!typedText[typedText.length - 1].isError) {
                        currentIndex--;
                    }
                    typedText.pop();
                    
                    // 백스페이스로 지운 후 잘못된 입력 표시
                    if (typedText.length > 0 && typedText[typedText.length - 1].text !== targetText[typedText.length - 1]) {
                        typedText[typedText.length - 1].isError = true;
                    }
                    highlightNextKey();
                }
            } else if (event.key.length === 1) {
                // 소리와 텍스트 효과 분리
                playRandomSound();  // 50% 확률로 소리 재생
                showRandomText();   // 매번 텍스트 표시
                
                if (pressedKey.toLowerCase() === expectedChar.toLowerCase()) {
                    typedText.push({ text: expectedChar, isError: false });
                    currentIndex++;
                    
                    let keyElement = pressedKey === ' ' 
                        ? document.querySelector('li[id="SPACE"]')
                        : document.querySelector(`li[id="${pressedKey.toUpperCase()}"]`);
                    
                    if (keyElement) {
                        keyElement.classList.add("hit");
                        keyElement.addEventListener('animationend', () => {
                            keyElement.classList.remove("hit");
                        });
                    }
                } else {
                    typedText.push({ text: pressedKey, isError: true });
                    setTimeout(() => {
                        if (typedText.length > 0 && typedText[typedText.length - 1].isError) {
                            typedText.pop();
                            updateDisplay();
                        }
                    }, 3000);
                }
                highlightNextKey();
            }
            
            updateDisplay();
        });

        // 초기 하이라이트
        highlightNextKey();
    });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>camera</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: url('./img/camera/background.png');
            background-size: cover;
            background-position: center;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #camera {
            width: 400px;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            user-select: none;
            -webkit-user-drag: none;
            z-index: 1000;
        }

        #film {
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 343.0311px;
            height: 219.8625px;
            border: 10px solid white;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: none;
            z-index: 1001;
        }

        #film img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>  
    <svg id="camera" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 491.03 345.86">
        <defs>
            <style>
                .cls-1 {
                  fill: #666;
                }
          
                .cls-1, .cls-2, .cls-3, .cls-4 {
                  stroke-width: 0px;
                }
          
                .cls-2 {
                  fill: #e6e6e6;
                }
          
                .cls-3 {
                  fill: #333;
                }
          
                .cls-4 {
                  fill: #ff7bac;
                }
              </style>
            </defs>
            <g id="Layer_1-2" data-name="Layer 1">
              <g>
                <path class="cls-3" d="M346.82,77.93h-202.61l28.39-56.58c6.56-13.07,20.12-21.35,34.97-21.35h75.89c14.85,0,28.41,8.28,34.97,21.35l28.39,56.58Z"/>
                <rect class="cls-2" x="210.18" y="35.6" width="70.66" height="42.33"/>
                <path class="cls-4" d="M413.14,32.59h33.31c10.43,0,18.9,8.47,18.9,18.9v11.69h-71.11v-11.69c0-10.43,8.47-18.9,18.9-18.9Z"/>
                <path class="cls-3" d="M467.61,63.18H23.41c-12.93,0-23.41,10.48-23.41,23.41v235.86c0,12.93,10.48,23.41,23.41,23.41h444.2c12.93,0,23.42-10.48,23.42-23.41V86.59c0-12.93-10.49-23.41-23.42-23.41ZM373.39,314.45H30.36V94.59h343.03v219.86Z"/>
                <circle class="cls-1" cx="434.17" cy="279.71" r="30.32"/>
                <circle class="cls-1" cx="417.44" cy="114.27" r="12.35"/>
                <circle class="cls-1" cx="450.9" cy="142.44" r="12.35"/>
              </g>
            </g>
          </svg>
    <div class="capture-area"></div>
    <div id="film"></div>

    <script>
        $(document).ready(function() {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;

            $("#camera").on("mousedown", function(e) {
                isDragging = true;
                const offset = $(this).offset();
                initialX = e.clientX - offset.left;
                initialY = e.clientY - offset.top;
                $(this).css('cursor', 'grabbing');
            });

            $(document).on("mousemove", function(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    $("#camera").css({
                        "left": currentX + "px",
                        "top": currentY + "px",
                        "transform": "none"
                    });
                }
            });

            $(document).on("mouseup", function() {
                isDragging = false;
                $("#camera").css('cursor', 'grab');
            });

            $(".cls-4").click(function() {
                const camera = $("#camera");
                const viewfinderArea = {
                    x: camera.offset().left + 30,
                    y: camera.offset().top + 95,
                    width: 343,
                    height: 220
                };

                html2canvas(document.body, {
                    backgroundColor: null
                }).then(canvas => {
                    const croppedCanvas = document.createElement('canvas');
                    const ctx = croppedCanvas.getContext('2d');
                    croppedCanvas.width = viewfinderArea.width;
                    croppedCanvas.height = viewfinderArea.height;
                    
                    ctx.drawImage(canvas, 
                        viewfinderArea.x, viewfinderArea.y, 
                        viewfinderArea.width, viewfinderArea.height,
                        0, 0, 
                        viewfinderArea.width, viewfinderArea.height
                    );

                    const film = $("#film");
                    film.empty().append($("<img>").attr("src", croppedCanvas.toDataURL()));
                    film.fadeIn();

                    // 1초 후 필름 사라짐
                    setTimeout(() => {
                        film.fadeOut();
                    }, 1000);
                });
            });
        });
    </script>
</body>
</html>
